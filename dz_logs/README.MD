# Домашняя работа по занятию "Основы сбора и хранения логов"
Опсиание домашнего задания:

1. в вагранте поднимаем 2 машины web и log
2. на web поднимаем nginx
3. на log настраиваем центральный лог сервер на любой системе на выбор

- journald;
- rsyslog;
- elk.

4. настраиваем аудит, следящий за изменением конфигов нжинкса

Все критичные логи с web должны собираться и локально и удаленно.
Все логи с nginx должны уходить на удаленный сервер (локально только критичные).
Логи аудита должны также уходить на удаленную систему.

---
1. ВМ запущены 
![1](./images/1.png)

2. На ВМ log включена настройка сервера syslog на стандартном порту
![2](./images/2.png)

3. Nginx перенастроен на отправку логов на ВМ log, с сохранением критических логов локально.
![3](./images/3.png)

4. Также в `/etc/rsyslog.d/nginx.conf` внесены изменения для отправки всех логов nginx.
![4](./images/4.png)

5. Тестовые запросы к вебсерверу
![5](./images/5.png)

6. Просмотр логов запросов на ВМ log 
![6](./images/6.png)

Для настройки аудита конфигурации nginx в `/etc/audit/rules.d/nginx.rules` внесена строка 
```
-w /etc/nginx/ -p wa -k nginx_conf_change
```
Правило прочитано с помощью комманды `sudo auditctl -R /etc/audit/rules.d/nginx.rules` и юнит auditd преезапущен.

А также в файл `/etc/rsyslog.d/audit.conf` внесена строка, которая пересылает все логи с тегом nginx_conf_change на удаленный сервер.
```
if $msg contains 'nginx_conf_change' then @@192.168.50.14:514
& stop
```

7. Демонстрация информациии об изменении конфигов nginx на ВМ log 
![7](./images/7.png)